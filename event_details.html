<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://www1.nyc.gov/assets/home/css/modules/content-api.css">
    <link rel="stylesheet" href="css/font-awesome/css/all.css">
    <link rel="stylesheet" href="https://www1.nyc.gov/assets/visionzero/css/theme.css">
    <link type="text/css" rel="stylesheet" charset="UTF-8"
        href="https://translate.googleapis.com/translate_static/css/translateelement.css">
    <link rel="stylesheet" href="css/site.css">
    <script type='text/javascript' src='config.js'></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"> </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.2/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.1.0/mustache.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/commonmark/0.28.1/commonmark.min.js"></script>


    <script>

        $(function () {
            $("#header").load("header.html");
            $("#footer").load("footer.html");
        });

        $.urlParam = function (name) {
            var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
            if (results == null) {
                return null;
            }
            return decodeURI(results[1]) || 0;
        }

        let id = $.urlParam('id');

        MarkDowntoHTML = function(data) {
            var reader = new commonmark.Parser();
            var writer = new commonmark.HtmlRenderer();
            var parsed = reader.parse(data);
            var result = writer.render(parsed);

            return result;
        };

        /* load spinner and make API call */
        var items = [];

        loadItems = function () {
            // Init variables
            var app_id = config.APP_ID;
            var app_key = config.APP_KEY;

            axios.get(
                "https://n9yvq.sse.codesandbox.io/events/"+id
              /*  "https://api.airtable.com/v0/" + app_id + "/Event?filterByFormula=ID_=" + id,
                {
                    headers: { Authorization: "Bearer " + app_key }
                }*/
            ).then(function (response) {
                //items = response.data.records;
                console.log(response);
                data = response.data[0];
                console.log(data);
                
                /*var reader = new commonmark.Parser();
                var writer = new commonmark.HtmlRenderer();
                var parsed = reader.parse(data.Participate);
                var result = writer.render(parsed);*/
                data.Details = MarkDowntoHTML(data.Details);
                data.Participate = MarkDowntoHTML(data.Participate);

                console.log(data);

                $("#content").load("event_template.html #template1", function () {
                    var template = document.getElementById('template1').innerHTML;
                    var output = Mustache.render(template, data);

                    $("#content").html(output);
                });

                console.log(items);
            }).catch(function (error) {
                console.log(error)
            })
        };

        loadItems();


        /* render HTML code*/

        console.log(id);

    </script>
</head>

<body>

    <div id="header"></div>

    <div id="content">

    </div>

    <div id="footer"></div>

    <div class="goog-te-spinner-pos">
        <div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner"
                width="96px" height="96px" viewBox="0 0 66 66">
                <circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33"
                    r="30"></circle>
            </svg></div>
    </div>

</body>

</html>